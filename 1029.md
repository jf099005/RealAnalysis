# Fubini theorem
$I_1:\{x=(x_1,x_2,\ldots,x_n), a_i\le x_i\le b_i,i=1,2,\ldots,n\}$
$I_2=\{y=(y_1,\ldots,y_n),c_i\le y_i\le d_i,i=1,2,\ldots,m\}$

Define $I=I_1\times I_2\subset \mathbb R^{n+m}$, $f:I\to\mathbb R$ satisfy $f\in L(I)$ i.e. $\int_E |f|dxdy<\infty$

($\implies \int_I f^+,\int_I f^-<\infty$)

then
1. $\forall x\in I_1$ a.e. ,  $y\to f(x,y)$ is measurable and $\int_{I_2} |f(x,y)|dy < \infty$
Also, $h(x):=\int_{I_2} f(x,y)dy$ is measurable and integrable on $I_1$
i.e. $h\in L(I_1)$

2. $\iint_I f(x,y)dxdy = \int_{I_1}\left[\int_{I_2} f(x,y)dy\right] dx = \int_{I_2}\left[\int_{I_1} f(x,y)dx\right] dy$

##### remark.
setting $f\equiv 0$ outside of $I$, it sufficient to prove the theorem for $I_1=\mathbb R^n$ and $I_2=\mathbb R^m$

### proof.
Before the proof, since $\iint_I f(x,y)dxdy < \infty$, $\iint_I f^+dxdy<\infty$ and $\iint_I f^- dxdy<\infty$

It sufficient to consider $f\ge 0$

#### Def.
A function $f\in L(dxdy)$ is said to have property $\mathcal F$ if Fubini's theorem is satisfied.

#### Lemma 1.
if $f,g$ have property $\mathcal F$, then $\alpha f+ \beta g$ has property $\mathcal F \forall \alpha,\beta\in\mathbb R$


proof: trivial from the linearity of the condition of $\mathcal F$

#### Lemma 2.
Let $f_1,f_2,\ldots$ have property $\mathcal F$ and $f_k\to f\in L(dxdy)$ increasingly (or decreasingly to $f\in L(dxdy)$)
Then $f$ has property $\mathcal F$

proof.
it suffices to prove for $f_k\to f$ increasing

From (i), $\exists Z_k,|Z_k|=0$ s.t. $x\notin Z_k\implies f(x,y)\in L(dy)$ and $h_k(x):=\int_{I_2} f_k(x,y)dy\in L(dx)$ and (ii) is satisfied.

DEfine $Z=\cup_k Z_k$, so $|Z|=0$, also $x\notin Z\implies f_k(x,y)\in L(dy)\forall k$
by the monotone property, i.e. $f_k\to f$ increasingly,
$f(x,y)$ is measurable for $x\notin Z$

$g_k(x)=\int f_k dy\to h(x)=\int f(x,y)dy\forall x\notin Z$ by monotone convergence property.

Also, $h_k \in L(dx)$, by the monotone convergence $\int h_k(x)\to \int h(x)dx$

$\underbrace{\iint f_k(d,y)dxdy}_{(1)}=\underbrace{\int\left[\int f_k(x,y)dy\right]dx}_{(2)}=\int \left[\int f_k(x,y)dx\right]dy$

by monotone convergence theorem, we have
- $(1)\to \iint f(x,y)dxdy$
- $(2)=\int h_k(x)dx\to \int h(x)dx=\int\left[\int fdy\right]dx$

Interchange the role of $x$ and $y$, we obtain $\iint f(x,y)dxdy=\int\left[\int f(x,y)dx\right]dy$

Since $f\in L(dxdy)$ and $h\in L(dx)$, i.e. $f$ and $h$ are finite a.e.

$\implies f(x,y)\in L(dy)$ when $x$ is fixed

#### Lemma 3.
Let $E$ be a $G_\delta$ set, i.e. $E=\cap_k G_k$ where $G_k$ is open $\forall k$

Assume $G_1$ has finite measure, then $\chi_E$ has property $\mathcal F$

proof.
Write $E_1=G_1,E_2=G_2\cap G_1,\ldots E_k=G_k\cap G_{k-1}\cap ...\cap G_1$
$\implies E_k\to E$ decreasingly.

Note that $|E_1|<\infty$, $|E_k|\to |E|$
$\implies \chi_{E_k}\to \chi_E$ decreasingly

By Lemma 2, if $\chi_{E_k}$ has property $\mathcal F$, then $\chi_E$ has property $\mathcal F$.

Now, $E_k$ is open $\forall k,$ therefore, it suffices to consider $\chi_G$ has property $\mathcal F$ when $G$ is open and $|G|<\infty$

Recall that any open set $G$ can be written as a countable union of **non-overlapping** cubes in $\mathbb R^{n+m}$ (or half-open **disjoint** cubes)

Now let $E$ be a half-open cube, e.g. $E=\{(x,y):a\le x<b,c\le y<d\}\subset \mathbb R^2$ (i.e. cube but some edges are open)

First consider $E$ as an open cube, i.e. $E=I_1\times I_2,I_1,I_2$ open,
It is easy to see that $\chi_E$ has property $\mathcal F$, $\iint\chi_Edxdy = |I_1|\times |I_2|$

if $E$ is part of boundary of cube, then $\chi_E$ has property $\mathcal F$ (and $\iint \chi_Edydx=0$)

Now $G=\cup_k E_k$, $\{E_k\}$: disjoint half-open cubes

$\implies \chi_{\cup_{k=1}^m E_k} = \sum_{k=1}^m\chi_{E_k}\to \chi_G$ increasingly

by Lemma 3, $\chi_E$ has property $\mathcal F$

#### recall
Any measurable set $E$ can be written as $E=G-Z$, where $G:G_\delta$ and $|Z|=0$

#### Lemma
Let $Z\subset \mathbb R^{n+m}$ and $|Z|=0$, then $\chi_Z$ has property $F$.

pf.
$\exists G_\delta$ set, say $H$, s.t. $|H|=|Z|=0$ and $Z\subseteq H$

(HOMEWORK)

### proof of Fubini's theorem
Let $\sum_{k=1}^m \alpha_k\chi_{E_k}$ be a sequence of simple functions s.t. $\sum_{k=1}^m \alpha_k\chi_{E_k}\to f\in L(dxdy)$ increasinly, then by Lemmas above, $f$ has property $\mathcal F$

#### remark
The finiteness of the integral $\iint_I |f(x,y)|dxdy$ implies the finiteness of $\int_{I_1} \left[ \int_{I_2} f(x,y)dy\right]dx$ and $\int_{I_2} \left[ \int_{I_1} f(x,y)dx\right]dy$,

But the converse is not true.

that is, the finiteness of $\int_{I_1} \left[ \int_{I_2} f(x,y)dy\right]dx$ and $\int_{I_2} \left[ \int_{I_1} f(x,y)dx\right]dy$ does not imply $\iint_I |f(x,y)|dxdy<\infty$

(Counterexample in textbook)

## Theorem
Let $f(x,y)$ be a measurable function on a measurable set $E\subseteq \mathbb R^{n+m}$, and let $E_x=\{y:(x,y)\in E\}\subseteq \mathbb R^m$, then

1. $\forall$ a.e. $x\in \mathbb R^n$, $f(x,y)$ is a measurable function of $y$ on $E_x$
2. If $f(x,y)\in L(E)$, then $\forall$ a.e. $x\in\mathbb R^n$, $f(x,y)$ is integrable on $E_x$ ($f(x,y)\in L(E_x)$)
 and $\int_{E_x} f(x,y)dy$ is measurable as a function of $x$ and is integrable
Moreover, $\iint_E f(x,y)dxdy = \int_{\mathbb R^n}\left[ \int_{E_x} f(x,y)dy\right]dx$ (zero-extend $f(x,y)$ from $E$ to $\mathbb R^{n+m}$)

## Theorem[Tonelli's theorem]
Let $f(x,y)\ge 0$ and measurable on $I=I_1\times I_2$
Then $\forall$ a.e. $x\in I_1$, $y\to f(x,y)$ is measurable.
Moreover, $h(x)=\int_{I_2}f(x,y)dy\ge 0$ is measurable, and
$\iint_I f(x,y)dxdy = \int_{I_1}\left[\int_{I_2} f(x,y)dy\right]dx$ ($=\int_{I_2}\left[\int_{I_1} f(x,y)dx\right]dy$)

#### remark
Fubini's theorem holds if $\iint_I f(x,y)dxdy=\pm\infty$
Assume that $\iint_I f(x,y)dxdy=+\infty \implies \iint_I f^+dydx=\infty$ and $\iint_I f^-dydx < +\infty$

By Tonelli's theorem, 
- $\iint_I f^+dxdy=\int_{I_1}\left[\int_{I_2}f^+dy\right]dx$
- $\iint_I f^-dxdy=\int_{I_1}\left[\int_{I_2}f^-dy\right]dx$

subtract both side $\implies \iint_I fdydx =\int_{I_1}\left[\int_{I_2}fdy\right]dx$

#### proof of Tonelli's theorem
Consider
$f_k(x,y)=\begin{cases}
0&{\rm if}\ |(x,y)|=\sqrt{x^2+y^2}\ge k\\
\min(k, f(x,y))&{\rm if}\ |(x,y)|<k
\end{cases}$

and $f_k\to f$ as $k\to\infty$
for each $f_k, \iint_I f_k(x, y)dydx=\int_{I_1}\left[\int_{I_2}fdy\right]dx=\int_{I_2}\left[\int_{I_1}fdx\right]dy$ by Fubini

Monotone convergence $\implies$ Theorem

## Application of Fubini-Tonelli theorem
Recall that if $f\ge 0$ on $E$, then Lebesgue integral $\int_E fdx=|R(f,E)|_{(n+1)}$

#### Theorem
If $f$ is measurable on $E$, then $R(f,E)$ is $\mathbb R^{n+1}$ measurable.

now, we can prove
## Theorem
$E$: measurable, $f\ge 0,R(f,E)$ measurable $\implies f$ measurable